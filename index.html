<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>moba.gg</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Inter', system-ui, sans-serif; }
    /* Bloco cinza da tier list */
    .tier-box {
      background: #f3f4f6;
      border-radius: 14px;
      margin-bottom: 36px;
      padding: 20px 16px 10px 56px;
      position: relative;
      min-height: 120px;
      box-shadow: 0 1px 8px rgba(30,40,60,0.07);
      max-width: 900px;
      margin-left: auto;
      margin-right: auto;
    }
    .tier-label {
      position: absolute;
      left: 0;
      top: 0;
      bottom: 0;
      width: 44px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      font-size: 1.6rem;
      color: #fff;
      writing-mode: vertical-rl;
      text-orientation: mixed;
      border-radius: 14px 0 0 14px;
      text-shadow: 0 1px 12px #23272f21;
      letter-spacing: -1px;
      z-index: 10;
    }
    .tier-label.ss { background: linear-gradient(135deg, #6366f1 60%, #7e22ce 100%); }
    .tier-label.s { background: linear-gradient(135deg, #7e22ce 30%, #6366f1 90%); }
    .tier-label.a { background: #ffb74d; color: #23272f; }
    .tier-container {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 18px 24px;
      padding: 8px 0 4px 0;
    }
    .card {
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(30,40,60,0.09);
      text-align: center;
      padding: 14px 10px 10px 10px;
      min-width: 138px;
      max-width: 138px;
      min-height: 175px;
      display: flex;
      flex-direction: column;
      align-items: center;
      transition: box-shadow 0.17s, transform 0.13s;
    }
    .card:hover {
      box-shadow: 0 8px 32px #6366f133;
      transform: translateY(-4px) scale(1.035);
    }
    .card > img[alt] {
      width: 62px;
      height: 62px;
      border-radius: 50%;
      margin-bottom: 8px;
      object-fit: cover;
      background: #232323;
      border: 2px solid #f3f4f6;
      box-shadow: 0 1px 6px #6366f122;
    }
    .hero-name {
      font-weight: 600;
      margin-top: 4px;
      color: #23272f;
      font-size: 1.02rem;
      letter-spacing: -0.5px;
      line-height: 1.1;
    }
    .hero-meta {
      font-size: 13px;
      color: #6366f1;
      font-weight: 600;
      margin-bottom: 2px;
    }
    .hero-routes {
      display: flex;
      gap: 7px;
      margin-top: 6px;
      justify-content: center;
      min-height: 21px;
    }
    .hero-routes.single {
      justify-content: center;
    }
    .hero-route img {
      width: 60px !important;
      height: 60px !important;
      border-radius: 50%;
      object-fit: cover;
      border: none !important;
      background: transparent !important;
      box-shadow: none !important;
      margin: 0 auto;
      display: block;
    }
    .hero-route span, .hero-route .route-name {
      display: none !important;
    }
    .hidden {
      display: none !important;
    }
    /* Footer estilizado */
    .footer-moba {
      background: #23272f;
      color: #b1b6c9;
      width: 100%;
      font-size: 1rem;
      min-height: 44px;
      display: flex;
      align-items: center;
      justify-content: flex-end;
      padding: 0 1.5rem;
      position: relative;
      font-family: 'Inter', system-ui, sans-serif;
      letter-spacing: 0.2px;
    }
    .footer-moba .byarthur {
      display: flex;
      align-items: center;
      gap: 3px;
      font-weight: 500;
      font-size: 1rem;
      color: #6d28d9;
      margin-left: 18px;
      letter-spacing: 0.3px;
    }
    .footer-moba .byarthur svg {
      margin-left: 4px;
      width: 18px;
      height: 18px;
      color: #6366f1;
      stroke-width: 1.7px;
      opacity: 0.98;
      transition: color 0.2s;
    }
    .footer-moba .byarthur:hover svg {
      color: #a78bfa;
    }
    @media (max-width: 600px) {
      .tier-box { padding-left: 24px; }
      .tier-label { width: 28px; font-size: 1.1rem; padding-right: 1px;}
      .tier-container { gap: 12px 10px; }
      .card { min-width: 120px; max-width: 120px;}
      .footer-moba { font-size: 0.93rem; padding: 0 0.7rem; }
    }
  </style>
</head>
<body class="bg-white min-h-screen flex flex-col">
  <!-- Header -->
  <header class="w-full bg-gradient-to-r from-indigo-500 to-purple-700 text-white py-4 shadow-md mb-8">
    <div class="container mx-auto flex justify-center">
      <span class="text-2xl font-bold tracking-tight">moba.gg</span>
    </div>
  </header>

  <!-- Main Content -->
  <main class="flex-grow container mx-auto px-2">
    <h1 class="text-3xl font-bold text-indigo-700 mb-8 text-center">Tier List - Mobile Legends</h1>
    <div class="flex flex-wrap justify-center gap-4 mb-5">
      <label for="rank" class="font-medium text-gray-700">Rank:</label>
      <select id="rank" class="rounded-lg border border-gray-300 px-3 py-2 focus:ring-2 focus:ring-indigo-400 focus:border-indigo-300 transition">
        <option value="mythic">Mythic</option>
        <option value="legend">Legend</option>
        <option value="epic">Epic</option>
        <option value="grandmaster">Grandmaster</option>
        <option value="master">Master</option>
        <option value="elite">Elite</option>
        <option value="warrior">Warrior</option>
      </select>
      <label for="days" class="font-medium text-gray-700">Dias:</label>
      <select id="days" class="rounded-lg border border-gray-300 px-3 py-2 focus:ring-2 focus:ring-indigo-400 focus:border-indigo-300 transition">
        <option value="1">1</option>
        <option value="3">3</option>
        <option value="7" selected>7</option>
        <option value="15">15</option>
        <option value="30">30</option>
      </select>
    </div>
    <div id="filter-section" class="mb-8 flex flex-wrap justify-center items-center gap-5 bg-gray-50 p-4 rounded-xl shadow">
      <h2 class="font-semibold text-indigo-500 text-base mb-0">Filtrar por Função e Rota</h2>
      <label for="role" class="font-medium text-gray-700">Função:</label>
      <select id="role" class="rounded-lg border border-gray-300 px-3 py-2 focus:ring-2 focus:ring-indigo-400 focus:border-indigo-300 transition">
        <option value="">Todas</option>
        <option value="mage">Mage</option>
        <option value="marksman">Marksman</option>
        <option value="tank">Tank</option>
        <option value="assassin">Assassin</option>
        <option value="fighter">Fighter</option>
        <option value="support">Support</option>
      </select>
      <label for="lane" class="font-medium text-gray-700">Rota:</label>
      <select id="lane" class="rounded-lg border border-gray-300 px-3 py-2 focus:ring-2 focus:ring-indigo-400 focus:border-indigo-300 transition">
        <option value="">Todas</option>
        <option value="mid">Mid</option>
        <option value="gold">Gold</option>
        <option value="exp">EXP</option>
        <option value="jungle">Jungle</option>
        <option value="roam">Roam</option>
      </select>
    </div>
    <!-- TIER LIST BLOCKS -->
    <div class="tier-box tier-ss mb-8">
      <div class="tier-label ss">SS</div>
      <div id="tier-ss" class="tier-container"></div>
    </div>
    <div class="tier-box tier-s mb-8">
      <div class="tier-label s">S</div>
      <div id="tier-s" class="tier-container"></div>
    </div>
    <div class="tier-box tier-a mb-8">
      <div class="tier-label a">A</div>
      <div id="tier-a" class="tier-container"></div>
    </div>
  </main>

  <!-- Footer -->
  <footer class="footer-moba">
    <span class="text-gray-400 mr-auto font-light text-sm">moba.gg &reg; 2025</span>
    <span class="byarthur">
      Arthur Henrique
      <a href="https://github.com/tutujokes" target="_blank" rel="noopener" aria-label="GitHub">
        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" class="inline ml-1">
          <path stroke-linecap="round" stroke-linejoin="round" d="M12 2C6.48 2 2 6.48 2 12c0 4.41 2.87 8.14 6.84 9.49.5.09.66-.21.66-.47 0-.23-.01-.84-.01-1.65-2.78.6-3.37-1.34-3.37-1.34-.45-1.15-1.11-1.46-1.11-1.46-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.89 1.52 2.34 1.08 2.91.82.09-.65.35-1.08.64-1.33-2.22-.25-4.56-1.11-4.56-4.95 0-1.09.39-1.99 1.03-2.69-.1-.25-.45-1.27.1-2.65 0 0 .84-.27 2.75 1.02a9.56 9.56 0 012.5-.34c.85 0 1.7.11 2.5.34 1.9-1.29 2.75-1.02 2.75-1.02.55 1.38.2 2.4.1 2.65.64.7 1.03 1.6 1.03 2.69 0 3.85-2.34 4.7-4.57 4.95.36.31.69.93.69 1.88 0 1.36-.01 2.46-.01 2.8 0 .26.16.57.67.47A10.004 10.004 0 0022 12c0-5.52-4.48-10-10-10z"/>
        </svg>
      </a>
    </span>
  </footer>

  <script>
    let heroIdToName = {};
    let heroNameToId = {};
    let heroExtraInfo = {};
    let tierCards = [];
    let tierRecords = [];

    function fetchHeroMap() {
      return fetch('https://mlbb-proxy.vercel.app/api/hero-list')
        .then(res => res.json())
        .then(map => {
          heroIdToName = map;
          heroNameToId = {};
          Object.entries(map).forEach(([id, name]) => {
            heroNameToId[name] = id;
          });
        });
    }

    function fetchAllHeroPositions() {
      return fetch('https://mlbb-proxy.vercel.app/api/hero-position?role=all&lane=all&size=127&index=1')
        .then(res => res.json())
        .then(json => {
          heroExtraInfo = {};
          (json.data.records || []).forEach(entry => {
            const heroData = entry.data;
            heroExtraInfo[String(heroData.hero_id)] = {
              role: (heroData.hero && heroData.hero.data && heroData.hero.data.sortid && heroData.hero.data.sortid.length && heroData.hero.data.sortid[0] && heroData.hero.data.sortid[0].data && heroData.hero.data.sortid[0].data.sort_title) ? heroData.hero.data.sortid[0].data.sort_title.toLowerCase() : "",
              roadsort: (heroData.hero && heroData.hero.data && heroData.hero.data.roadsort) ? heroData.hero.data.roadsort : []
            };
          });
        });
    }

    function carregarTierList() {
      const rank = document.getElementById('rank').value;
      const days = document.getElementById('days').value;
      const url = `https://mlbb-proxy.vercel.app/api/hero-rank?source=rank&days=${days}&rank=${rank}&size=130&sort_field=win_rate&sort_order=desc`;

      document.getElementById('tier-ss').innerHTML = '';
      document.getElementById('tier-s').innerHTML = '';
      document.getElementById('tier-a').innerHTML = '';
      tierCards = [];
      tierRecords = [];

      Promise.all([fetchHeroMap(), fetchAllHeroPositions(), fetch(url).then(res => res.json())])
        .then(([_, __, json]) => {
          const records = json.data.records || [];
          tierRecords = records;

          records.forEach(entry => {
            const hero = entry.data.main_hero.data;
            const winRate = (entry.data.main_hero_win_rate * 100).toFixed(1);

            const heroId = heroNameToId[hero.name];
            const info = heroExtraInfo[heroId] || {};
            const role = info.role || '';
            let roadsortTitles = [];
            let iconCount = 0;
            let roadsortHtml = '';

            if (Array.isArray(info.roadsort) && info.roadsort.length > 0) {
              roadsortTitles = info.roadsort.map(rs => (rs.data && rs.data.road_sort_title) ? rs.data.road_sort_title : '').filter(Boolean);
              iconCount = info.roadsort.length;
              roadsortHtml = info.roadsort.map(rs => {
                const data = rs.data || {};
                return data.road_sort_icon
                  ? `<span class="hero-route"><img src="${data.road_sort_icon}" alt="" title="${data.road_sort_title}"></span>`
                  : '';
              }).join('');
            } else {
              iconCount = 0;
              roadsortHtml = '';
            }

            const el = document.createElement('div');
            el.className = 'card';
            el.setAttribute('data-role', role);
            el.setAttribute('data-routes', roadsortTitles.join('|').toLowerCase());
            el.setAttribute('data-id', heroId || '');
            el.setAttribute('data-name', hero.name);

            if (iconCount === 1) {
              el.innerHTML = `
                <img src="${hero.head}" alt="${hero.name}">
                <div class="hero-name">${hero.name}</div>
                <div class="hero-meta">${winRate}% WR</div>
                <div class="hero-routes single">${roadsortHtml}</div>
              `;
            } else if (iconCount > 1) {
              el.innerHTML = `
                <img src="${hero.head}" alt="${hero.name}">
                <div class="hero-name">${hero.name}</div>
                <div class="hero-meta">${winRate}% WR</div>
                <div class="hero-routes">${roadsortHtml}</div>
              `;
            } else {
              el.innerHTML = `
                <img src="${hero.head}" alt="${hero.name}">
                <div class="hero-name">${hero.name}</div>
                <div class="hero-meta">${winRate}% WR</div>
                <div class="hero-routes" style="height:21px"></div>
              `;
            }

            tierCards.push(el);

            if (winRate >= 54) {
              document.getElementById('tier-ss').appendChild(el);
            } else if (winRate >= 51) {
              document.getElementById('tier-s').appendChild(el);
            } else {
              document.getElementById('tier-a').appendChild(el);
            }
          });
        })
        .catch(err => {
          console.error("Erro ao carregar tier list:", err);
        });
    }

    function filtrarTierList() {
      const role = document.getElementById('role').value.toLowerCase();
      const lane = document.getElementById('lane').value.toLowerCase();

      document.querySelectorAll('.tier-container .card').forEach(card => {
        const heroRole = (card.getAttribute('data-role') || '').toLowerCase();
        const heroRoutes = (card.getAttribute('data-routes') || '').toLowerCase();
        let mostra = true;
        if (role && !heroRole.includes(role)) mostra = false;
        if (lane && !heroRoutes.includes(lane)) mostra = false;
        card.classList.toggle('hidden', !mostra);
      });
    }

    document.addEventListener('DOMContentLoaded', function () {
      carregarTierList();

      document.getElementById('rank').addEventListener('change', carregarTierList);
      document.getElementById('days').addEventListener('change', carregarTierList);
      document.getElementById('role').addEventListener('change', filtrarTierList);
      document.getElementById('lane').addEventListener('change', filtrarTierList);
    });
  </script>
</body>
</html>
